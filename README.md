# Apache Livy

[![Build Status](https://travis-ci.org/apache/incubator-livy.svg?branch=master)](https://travis-ci.org/apache/incubator-livy)

Apache Livy is an open source REST interface for interacting with
[Apache Spark](http://spark.apache.org) from anywhere. It supports executing snippets of code or
programs in a Spark context that runs locally or in
[Apache Hadoop YARN](http://hadoop.apache.org/docs/current/hadoop-yarn/hadoop-yarn-site/YARN.html).

* Interactive Scala, Python and R shells
* Batch submissions in Scala, Java, Python
* Multiple users can share the same server (impersonation support)
* Can be used for submitting jobs from anywhere with REST
* Does not require any code change to your programs

[Pull requests](https://github.com/apache/incubator-livy/pulls) are welcomed! But before you begin,
please check out the [Contributing](http://livy.incubator.apache.org/community#Contributing)
section on the [Community](http://livy.incubator.apache.org/community) page of our website.

## Online Documentation

Guides and documentation on getting started using Livy, example code snippets, and Livy API
documentation can be found at [livy.incubator.apache.org](http://livy.incubator.apache.org).

## Before Building Livy

To build Livy, you will need:

Debian/Ubuntu:
  * mvn (from ``maven`` package or maven3 tarball)
  * openjdk-7-jdk (or Oracle Java7 jdk)
  * Python 2.6+
  * R 3.x

Redhat/CentOS:
  * mvn (from ``maven`` package or maven3 tarball)
  * java-1.7.0-openjdk (or Oracle Java7 jdk)
  * Python 2.6+
  * R 3.x

MacOS:
  * Xcode command line tools
  * Oracle's JDK 1.7+
  * Maven (Homebrew)
  * Python 2.6+
  * R 3.x

Required python packages for building Livy:
  * cloudpickle
  * requests
  * requests-kerberos
  * flake8
  * flaky
  * pytest


To run Livy, you will also need a Spark installation. You can get Spark releases at
https://spark.apache.org/downloads.html.

Livy requires at least Spark 1.6 and supports both Scala 2.10 and 2.11 builds of Spark, Livy
will automatically pick repl dependencies through detecting the Scala version of Spark.

Livy also supports Spark 2.0+ for both interactive and batch submission, you could seamlessly
switch to different versions of Spark through ``SPARK_HOME`` configuration, without needing to
rebuild Livy.


## Building Livy

Livy is built using [Apache Maven](http://maven.apache.org). To check out and build Livy, run:

```
git clone https://github.com/apache/incubator-livy.git
cd livy
mvn package
```

By default Livy is built against Apache Spark 1.6.2, but the version of Spark used when running
Livy does not need to match the version used to build Livy. Livy internally uses reflection to
mitigate the gaps between different Spark versions, also Livy package itself does not
contain a Spark distribution, so it will work with any supported version of Spark (Spark 1.6+)
without needing to rebuild against specific version of Spark.

## Livy for DataStreams

If you use a proxy user, you should add to the payload in your curl POST on */batches*:
```
"proxyUser":"talend",
```

You can post a Job without specifying any **jars** arguments, if in Livy conf you have specified a folder with dependencies **livy.job.dependencies.folder**
See the curl:

```
curl -X POST --data $'{"file": "file:///opt/datastreams-deps/data-streams-streamsjob-0.6.0-SNAPSHOT.jar",
"className": "org.talend.datastreams.jobs.DataStreamsJob",
"proxyUser":"talend",
"args":["something", "ewogICJhdXRoZW50aWNhdGlvbiIgOiB7CiAgICAiYXV0aGVudGljYXRpb25UeXBlIiA6ICJTSU1QTEUiLAogICAgImlkIiA6ICI1ZTUzNjc2OC1hMGRiLTQyYWEtYWNkNi0wYWNiZmM5MDAzMDQiLAogICAgInByb3BlcnRpZXMiIDogewogICAgICAicGFzc3dvcmQiIDogIioqKioiLAogICAgICAidXNlcm5hbWUiIDogInRhbGVuZCIKICAgIH0KICB9LAogICJjb250ZXh0IiA6IHsKICAgICJ2YXJpYWJsZXMiIDoge30KICB9LAogICJkYXRhc2V0cyIgOiBbCiAgICB7CiAgICAgICJjcmVhdGVkIiA6IDE1MDMzMDMxMDA0NjQsCiAgICAgICJkYXRhc3RvcmVJZCIgOiAiOGNiNjg2ZTEtNmQ4Ni00ODE2LWI0Y2ItNGY2M2FhODkyOWM3IiwKICAgICAgImVuYWJsZWQiIDogdHJ1ZSwKICAgICAgImlkIiA6ICI3OWM0OWM0NS0xY2IyLTQ1MDctYjM1YS1lM2E2ZTYxOTY0MDQiLAogICAgICAibGFiZWwiIDogIkVESVQgSERGUyIsCiAgICAgICJvd25lciIgOiAiYWRtaW4iLAogICAgICAicHJvcGVydGllcyIgOiB7CiAgICAgICAgIkBkZWZpbml0aW9uTmFtZSIgOiAiU2ltcGxlRmlsZUlvRGF0YXNldCIsCiAgICAgICAgImZpZWxkRGVsaW1pdGVyIiA6ICJTRU1JQ09MT04iLAogICAgICAgICJmb3JtYXQiIDogIkNTViIsCiAgICAgICAgInBhdGgiIDogIi9vcHQvaG9zdC9pbnB1dC50eHQiLAogICAgICAgICJyZWNvcmREZWxpbWl0ZXIiIDogIkxGIiwKICAgICAgICAic3BlY2lmaWNGaWVsZERlbGltaXRlciIgOiAiOyIsCiAgICAgICAgInNwZWNpZmljUmVjb3JkRGVsaW1pdGVyIiA6ICJcXG4iCiAgICAgIH0sCiAgICAgICJ0eXBlIiA6ICJTaW1wbGVGaWxlSW9EYXRhc2V0IiwKICAgICAgInVwZGF0ZWQiIDogMTUwMzMwNjE5NTc3OCwKICAgICAgInZlcnNpb24iIDogNgogICAgfSwKICAgIHsKICAgICAgImNyZWF0ZWQiIDogMTUwMzMwMzEwNjA4MSwKICAgICAgImRhdGFzdG9yZUlkIiA6ICI1OWMzNjRiYi00N2JlLTQ1N2MtYTgwNS05NTMzMDAzZjI5NTkiLAogICAgICAiZW5hYmxlZCIgOiB0cnVlLAogICAgICAiaWQiIDogImQzMGU3ZTE0LTM3NWEtNDljNy04N2ViLTYyZTFiNjE0NTAwZCIsCiAgICAgICJsYWJlbCIgOiAiZmlsdGVyMV9tYWluIiwKICAgICAgIm93bmVyIiA6ICJhZG1pbiIsCiAgICAgICJwcm9wZXJ0aWVzIiA6IHsKICAgICAgICAiQGRlZmluaXRpb25OYW1lIiA6ICJTaW1wbGVGaWxlSW9EYXRhc2V0IiwKICAgICAgICAiZmllbGREZWxpbWl0ZXIiIDogIlNFTUlDT0xPTiIsCiAgICAgICAgImZvcm1hdCIgOiAiQ1NWIiwKICAgICAgICAicGF0aCIgOiAiL29wdC9ob3N0L291dHB1dCIsCiAgICAgICAgInJlY29yZERlbGltaXRlciIgOiAiTEYiLAogICAgICAgICJzcGVjaWZpY0ZpZWxkRGVsaW1pdGVyIiA6ICI7IiwKICAgICAgICAic3BlY2lmaWNSZWNvcmREZWxpbWl0ZXIiIDogIlxcbiIKICAgICAgfSwKICAgICAgInR5cGUiIDogIlNpbXBsZUZpbGVJb0RhdGFzZXQiLAogICAgICAidXBkYXRlZCIgOiAxNTAzMzAzMTA2MjU0LAogICAgICAidmVyc2lvbiIgOiAyCiAgICB9CiAgXSwKICAiZGF0YXN0b3JlcyIgOiBbCiAgICB7CiAgICAgICJjcmVhdGVkIiA6IDE1MDMzMDMwNzIzNTQsCiAgICAgICJlbmFibGVkIiA6IHRydWUsCiAgICAgICJpZCIgOiAiOGNiNjg2ZTEtNmQ4Ni00ODE2LWI0Y2ItNGY2M2FhODkyOWM3IiwKICAgICAgImxhYmVsIiA6ICJFRElUIEhERlMiLAogICAgICAib3duZXIiIDogImFkbWluIiwKICAgICAgInByb3BlcnRpZXMiIDogewogICAgICAgICJAZGVmaW5pdGlvbk5hbWUiIDogIlNpbXBsZUZpbGVJb0RhdGFzdG9yZSIsCiAgICAgICAgImtlcmJlcm9zS2V5dGFiIiA6ICIvaG9tZS91c2VybmFtZS91c2VybmFtZS5rZXl0YWIiLAogICAgICAgICJrZXJiZXJvc1ByaW5jaXBhbCIgOiAidXNlcm5hbWVARVhBTVBMRS5DT00iLAogICAgICAgICJ1c2VLZXJiZXJvcyIgOiBmYWxzZSwKICAgICAgICAidXNlck5hbWUiIDogInRhbGVuZCIKICAgICAgfSwKICAgICAgInR5cGUiIDogIlNpbXBsZUZpbGVJb0RhdGFzdG9yZSIsCiAgICAgICJ1cGRhdGVkIiA6IDE1MDMzMDMxMDA4NTIsCiAgICAgICJ2ZXJzaW9uIiA6IDQKICAgIH0sCiAgICB7CiAgICAgICJjcmVhdGVkIiA6IDE1MDMzMDMwNzc5MjUsCiAgICAgICJkZXNjcmlwdGlvbiIgOiAiUUEgSERGUyBjb25uZWN0aW9uIGRlc2NyaXB0aW9uIiwKICAgICAgImVuYWJsZWQiIDogdHJ1ZSwKICAgICAgImlkIiA6ICI1OWMzNjRiYi00N2JlLTQ1N2MtYTgwNS05NTMzMDAzZjI5NTkiLAogICAgICAibGFiZWwiIDogIkhERlMiLAogICAgICAib3duZXIiIDogImFkbWluIiwKICAgICAgInByb3BlcnRpZXMiIDogewogICAgICAgICJAZGVmaW5pdGlvbk5hbWUiIDogIlNpbXBsZUZpbGVJb0RhdGFzdG9yZSIsCiAgICAgICAgImtlcmJlcm9zS2V5dGFiIiA6ICIvaG9tZS91c2VybmFtZS91c2VybmFtZS5rZXl0YWIiLAogICAgICAgICJrZXJiZXJvc1ByaW5jaXBhbCIgOiAidXNlcm5hbWVARVhBTVBMRS5DT00iLAogICAgICAgICJ1c2VLZXJiZXJvcyIgOiBmYWxzZQogICAgICB9LAogICAgICAidHlwZSIgOiAiU2ltcGxlRmlsZUlvRGF0YXN0b3JlIiwKICAgICAgInVwZGF0ZWQiIDogMTUwMzMwMzEzOTkzOSwKICAgICAgInZlcnNpb24iIDogMTkKICAgIH0KICBdLAogICJlbnZpcm9ubWVudCIgOiB7CiAgICAiZGVzY3JpcHRpb24iIDogIiIsCiAgICAiaWQiIDogIjkwZDVlMzg4LTYzZDQtNDZhZS04Y2E3LWMzYjQ2NzBjZGZmZCIsCiAgICAibGFiZWwiIDogIiIsCiAgICAicHJvcGVydGllcyIgOiB7fSwKICAgICJ0dW5pbmdQcm9wZXJ0aWVzIiA6IHt9CiAgfSwKICAiaWQiIDogIjU5OWFhMGRjMzNkYzNjODZjN2MzNDUzMyIsCiAgInBpcGVsaW5lcyIgOiBbCiAgICB7CiAgICAgICJjb21wb25lbnRzIiA6IFsKICAgICAgICB7CiAgICAgICAgICAiZGF0YSIgOiB7CiAgICAgICAgICAgICJkYXRhc2V0SWQiIDogImQzMGU3ZTE0LTM3NWEtNDljNy04N2ViLTYyZTFiNjE0NTAwZCIsCiAgICAgICAgICAgICJwcm9wZXJ0aWVzIiA6IHsKICAgICAgICAgICAgICAiQGRlZmluaXRpb25OYW1lIiA6ICJTaW1wbGVGaWxlSW9PdXRwdXQiLAogICAgICAgICAgICAgICJkYXRhc2V0X2RlZmluaXRpb24iIDoge30sCiAgICAgICAgICAgICAgIm1lcmdlT3V0cHV0IiA6IGZhbHNlLAogICAgICAgICAgICAgICJvdmVyd3JpdGUiIDogZmFsc2UKICAgICAgICAgICAgfQogICAgICAgICAgfSwKICAgICAgICAgICJpZCIgOiAiNTk5YWEwZWMzM2RjM2M4NmM3YzM0NTNjIiwKICAgICAgICAgICJ0eXBlIiA6ICJTaW1wbGVGaWxlSW9PdXRwdXQiCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAiZGF0YSIgOiB7CiAgICAgICAgICAgICJkYXRhc2V0SWQiIDogIjc5YzQ5YzQ1LTFjYjItNDUwNy1iMzVhLWUzYTZlNjE5NjQwNCIsCiAgICAgICAgICAgICJwcm9wZXJ0aWVzIiA6IHsKICAgICAgICAgICAgICAiQGRlZmluaXRpb25OYW1lIiA6ICJTaW1wbGVGaWxlSW9JbnB1dCIsCiAgICAgICAgICAgICAgImRhdGFzZXRfZGVmaW5pdGlvbiIgOiB7fSwKICAgICAgICAgICAgICAibGltaXQiIDogLTEKICAgICAgICAgICAgfQogICAgICAgICAgfSwKICAgICAgICAgICJpZCIgOiAiNTk5YWEwZTIzM2RjM2M4NmM3YzM0NTM2IiwKICAgICAgICAgICJ0eXBlIiA6ICJTaW1wbGVGaWxlSW9JbnB1dCIKICAgICAgICB9CiAgICAgIF0sCiAgICAgICJpZCIgOiAiNTk5YWEwZGMzM2RjM2M4NmM3YzM0NTM0IiwKICAgICAgInBvcnRzIiA6IFsKICAgICAgICB7CiAgICAgICAgICAiZGF0YSIgOiB7CiAgICAgICAgICAgICJmbG93VHlwZSIgOiAiTUFJTiIKICAgICAgICAgIH0sCiAgICAgICAgICAiaWQiIDogIjU5OWFhMGUyMzNkYzNjODZjN2MzNDUzNyIsCiAgICAgICAgICAibm9kZUlkIiA6ICI1OTlhYTBlMjMzZGMzYzg2YzdjMzQ1MzYiCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAiZGF0YSIgOiB7CiAgICAgICAgICAgICJmbG93VHlwZSIgOiAiTUFJTiIKICAgICAgICAgIH0sCiAgICAgICAgICAiaWQiIDogIjU5OWFhMGVjMzNkYzNjODZjN2MzNDUzZCIsCiAgICAgICAgICAibm9kZUlkIiA6ICI1OTlhYTBlYzMzZGMzYzg2YzdjMzQ1M2MiCiAgICAgICAgfQogICAgICBdLAogICAgICAicnVubmVyIiA6ICJmNjk4ZjZiZC0yMDZhLTRmYjYtODRjMC0zODcwYmZkNTM2NTQiLAogICAgICAic3RlcHMiIDogWwogICAgICAgIHsKICAgICAgICAgICJkYXRhIiA6IHsKICAgICAgICAgICAgInByb3BlcnRpZXMiIDoge30KICAgICAgICAgIH0sCiAgICAgICAgICAiaWQiIDogIjU5OWFhMGVjMzNkYzNjODZjN2MzNDUzZSIsCiAgICAgICAgICAic291cmNlSWQiIDogIjU5OWFhMGUyMzNkYzNjODZjN2MzNDUzNyIsCiAgICAgICAgICAidGFyZ2V0SWQiIDogIjU5OWFhMGVjMzNkYzNjODZjN2MzNDUzZCIKICAgICAgICB9CiAgICAgIF0KICAgIH0KICBdLAogICJydW5uZXJzIiA6IFsKICAgIHsKICAgICAgImVudmlyb25tZW50SWQiIDogIjkwZDVlMzg4LTYzZDQtNDZhZS04Y2E3LWMzYjQ2NzBjZGZmZCIsCiAgICAgICJpZCIgOiAiZjY5OGY2YmQtMjA2YS00ZmI2LTg0YzAtMzg3MGJmZDUzNjU0IiwKICAgICAgInByb3BlcnRpZXMiIDogewogICAgICAgICJzcGFya01hc3RlciIgOiAibG9jYWxbNF0iLAogICAgICAgICJ1c2VzUHJvdmlkZWRTcGFya0NvbnRleHQiIDogZmFsc2UKICAgICAgfSwKICAgICAgInJ1bm5lclR5cGUiIDogIlNwYXJrUnVubmVyIiwKICAgICAgInR1bmluZ1Byb3BlcnRpZXMiIDoge30KICAgIH0KICBdLAogICJzY2hlbWFzIiA6IFtdCn0K"]
}' -H "Content-Type: application/json" localhost:8998/batches
```


